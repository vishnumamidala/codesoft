<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculator </title>



<style>

:root{
  --device-bg: linear-gradient(180deg,#071022 0%, #081227 60%);
  --panel: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.006));
  --glass: rgba(255,255,255,0.04);
  --muted: #9fb7cc;
  --accent: #ff9500;       /* orange */
  --accent-2: #0fbaff;     /* blue highlight */
  --text: #eaf6ff;
  --soft: rgba(255,255,255,0.03);
  --shadow-outer: 0 40px 120px rgba(0,0,0,0.6);
  --shadow-inner: inset 0 -6px 18px rgba(0,0,0,0.2);
  --radius: 30px;
  --device-width: 380px;
  --display-h: 120px;
  --gap: 10px;
  --ui-font: "SF Pro Text", "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}


:root.light {
  --device-bg: linear-gradient(180deg,#fbfdff,#f3f8ff);
  --panel: linear-gradient(180deg, rgba(0,0,0,0.03), rgba(0,0,0,0.01));
  --glass: rgba(0,0,0,0.04);
  --muted: #4b5563;
  --accent: #ff7b00;
  --accent-2: #007aff;
  --text: #051428;
  --soft: rgba(0,0,0,0.04);
  --shadow-outer: 0 28px 70px rgba(9,30,60,0.08);
  --shadow-inner: inset 0 -6px 12px rgba(0,0,0,0.03);
}


:root.night {
  --device-bg: linear-gradient(180deg,#000000,#021028);
  --panel: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.002));
  --glass: rgba(255,255,255,0.02);
  --muted: #99e6ff;
  --accent: #ffd166;
  --accent-2: #66f0ff;
  --text: #e8fbff;
  --soft: rgba(255,255,255,0.02);
  --shadow-outer: 0 40px 130px rgba(0,0,0,0.85);
  --shadow-inner: inset 0 -8px 20px rgba(0,0,0,0.45);
}


*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: var(--ui-font);
  background: #091223;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:28px;
  color:var(--text);
  transition: background .4s ease, color .3s ease;
  -webkit-font-smoothing:antialiased;
}


.device {
  width: var(--device-width);
  border-radius: 46px;
  padding: 14px;
  position: relative;
  background: var(--device-bg);
  box-shadow: var(--shadow-outer);
  border: 1px solid rgba(255,255,255,0.02);
  overflow: visible;
}


.dynamic-island {
  position: absolute;
  top: 8px;
  left: 50%;
  transform: translateX(-50%);
  width: 210px;
  height: 36px;
  border-radius: 999px;
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.02));
  backdrop-filter: blur(6px);
  box-shadow: 0 8px 28px rgba(0,0,0,0.25), inset 0 -1px 0 rgba(255,255,255,0.02);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index: 30;
}

.dynamic-island::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:999px;
  box-shadow: 0 12px 40px rgba(0,170,255,0.035);
  pointer-events:none;
}


.device-inner {
  padding: 18px 18px 22px;
  margin-top: 40px; 
}


.display {
  height: var(--display-h);
  border-radius: 20px;
  padding: 18px;
  background: var(--panel);
  border: 1px solid var(--soft);
  box-shadow: var(--shadow-inner);
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  justify-content:center;
  gap: 6px;
  overflow:hidden;
}


.expr {
  color: var(--muted);
  font-size: 14px;
  min-height: 18px;
}
.result {
  font-size: 44px;
  font-weight: 700;
  line-height: 1;
  word-break: break-word;
  letter-spacing: 0.6px;
}


.keypad {
  margin-top: 12px;
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}


.btn {
  height: 62px;
  border-radius: 14px;
  border: 0;
  font-weight: 700;
  font-size: 20px;
  cursor: pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  color: var(--text);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  transition: transform .12s ease, box-shadow .12s ease;
  position: relative;
  overflow: hidden;
}


.btn::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  width: 120%;
  height: 120%;
  background: rgba(255,255,255,0.06);
  border-radius: inherit;
  transform: translate(-50%,-50%) scale(0);
  opacity: 0;
  transition: transform .28s cubic-bezier(.2,.9,.2,1), opacity .28s;
}
.btn:active::after { transform: translate(-50%,-50%) scale(1); opacity: 1; transition: transform .06s; }


.btn.gray { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.03)); color: var(--muted); }
.btn.func { background: linear-gradient(180deg, rgba(0,0,0,0.06), rgba(0,0,0,0.03)); color: var(--muted); }
.btn.orange { background: linear-gradient(180deg,var(--accent), #ff7b00); color:#08111a; box-shadow: 0 12px 34px rgba(255,123,0,0.12); }
.btn.eq { background: linear-gradient(180deg,var(--accent-2), #0db8ff); color:#031120; box-shadow: 0 12px 34px rgba(13,184,255,0.12); }
.btn.zero { grid-column: span 2; justify-content:flex-start; padding-left:20px; }


.btn.active-op { transform: translateY(-6px) scale(1.02); box-shadow: 0 26px 56px rgba(0,0,0,0.45); }


@media (hover:hover) {
  .btn:hover { transform: translateY(-6px) rotateX(3deg); box-shadow: 0 28px 60px rgba(0,0,0,0.45); }
}

.scientific {
  display:none;
  margin-top: 12px;
  gap: 10px;
  grid-template-columns: repeat(5, 1fr);
}
.scientific .btn { height:48px; font-size:14px; border-radius:10px; }


.mem-row { display:flex; gap:10px; margin-top: 10px; }
.mem-btn { flex:1; padding:10px 12px; border-radius:10px; background:var(--glass); border:1px solid var(--soft); color:var(--muted); font-weight:700; }


.kbd { font-size:12px; color:var(--muted); }


@media (min-width:540px) {
  :root { --device-width: 420px; --display-h: 140px; }
  .scientific { display:grid; }
}


:root.light body & {}

.btn:focus { outline: 3px solid rgba(255,255,255,0.06); outline-offset: 4px; }


.device { transition: box-shadow .35s ease, background .35s ease; }


.footer-space { height: 10px; }

/* small helpers */
.hidden { display:none; }
</style>
</head>
<body>

<div class="device" id="deviceRoot" role="application" aria-label="Scientific calculator">

  <!-- Dynamic Island -->
  <div class="dynamic-island" aria-hidden="true"></div>

  <!-- inner content -->
  <div class="device-inner">

    <!-- top controls (only theme toggle / nothing else per request) -->
    <div style="display:flex;justify-content:flex-end;align-items:center;gap:8px;margin-bottom:8px;">
      <button id="themeCycle" class="btn gray" title="Cycle theme (Dark â†’ Light â†’ Night)">ðŸŒ™</button>
    </div>

    <!-- display -->
    <div class="display" role="status" aria-live="polite">
      <div class="expr" id="expr">&nbsp;</div>
      <div class="result" id="screen">0</div>
    </div>

    <!-- keypad -->
    <div class="keypad" id="keypad">

      <!-- top row -->
      <button class="btn gray" data-action="clear">AC</button>
      <button class="btn gray" data-action="plusminus">Â±</button>
      <button class="btn gray" data-action="percent">%</button>
      <button class="btn orange" data-action="op" data-op="Ã·">Ã·</button>

      <!-- scientific / trig row -->
      <button class="btn func" data-action="func" data-func="sin">sin</button>
      <button class="btn func" data-action="func" data-func="cos">cos</button>
      <button class="btn func" data-action="func" data-func="tan">tan</button>
      <button class="btn orange" data-action="op" data-op="Ã—">Ã—</button>

      <!-- numbers -->
      <button class="btn" data-digit="7">7</button>
      <button class="btn" data-digit="8">8</button>
      <button class="btn" data-digit="9">9</button>
      <button class="btn orange" data-action="op" data-op="âˆ’">âˆ’</button>

      <button class="btn" data-digit="4">4</button>
      <button class="btn" data-digit="5">5</button>
      <button class="btn" data-digit="6">6</button>
      <button class="btn orange" data-action="op" data-op="+">+</button>

      <button class="btn" data-digit="1">1</button>
      <button class="btn" data-digit="2">2</button>
      <button class="btn" data-digit="3">3</button>
      <button class="btn eq" data-action="equals">=</button>

      <button class="btn zero" data-digit="0">0</button>
      <button class="btn" data-digit=".">.</button>

      <!-- scientific toggle / memory row (spans full width) -->
      <div style="grid-column:1/-1; display:flex; justify-content:space-between; align-items:center; gap:10px;">
        <div class="kbd">Scientific</div>
        <div class="mem-row" style="width:60%">
          <button class="mem-btn" id="mPlus">M+</button>
          <button class="mem-btn" id="mMinus">M-</button>
          <button class="mem-btn" id="mrc">MR</button>
          <button class="mem-btn" id="mc">MC</button>
        </div>
      </div>

      <!-- scientific panel (hidden small) -->
      <div class="scientific" id="scientificPanel" aria-hidden="true" style="grid-column:1/-1;">
        <button class="btn" data-sci="ln">ln</button>
        <button class="btn" data-sci="log10">log</button>
        <button class="btn" data-sci="sqrt">âˆš</button>
        <button class="btn" data-sci="pow2">xÂ²</button>
        <button class="btn" data-sci="pow3">xÂ³</button>

        <button class="btn" data-sci="pi">Ï€</button>
        <button class="btn" data-sci="e">e</button>
        <button class="btn" data-sci="fact">n!</button>
        <button class="btn" data-sci="pow">xÊ¸</button>
        <button class="btn" data-sci="inv">1/x</button>
      </div>

    </div>

    <div class="footer-space"></div>
  </div>
</div>


<script>

const CLICK_WAV = "data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA="; 


let audioCtx = null;
function ensureAudio(){
  if (!audioCtx) {
    try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e){ audioCtx = null; }
  }
}
function playClick(){
  ensureAudio();
  if (!audioCtx) return;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'square';
  o.frequency.value = 1200;
  g.gain.value = 0.0005;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  const now = audioCtx.currentTime;
  g.gain.setValueAtTime(0.0006, now);
  g.gain.exponentialRampToValueAtTime(0.000001, now + 0.06);
  o.stop(now + 0.07);
}
function playSoft(){
  ensureAudio();
  if (!audioCtx) return;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'sine';
  o.frequency.value = 800;
  g.gain.value = 0.00045;
  o.connect(g); g.connect(audioCtx.destination);
  const now = audioCtx.currentTime;
  o.start();
  g.gain.setValueAtTime(0.00045, now);
  g.gain.exponentialRampToValueAtTime(0.000001, now + 0.08);
  o.stop(now + 0.09);
}


function haptic(){
  if (navigator.vibrate) navigator.vibrate(10);
}


function feedback(type){

  if (type === 'soft') playSoft();
  else playClick();
  haptic();
}
</script>


<script>

const screen = document.getElementById('screen');
const expr = document.getElementById('expr');
const keypad = document.getElementById('keypad');
const sciPanel = document.getElementById('scientificPanel');

let current = "0";
let stored = null;
let pendingOp = null;
let shouldReset = false;
let memory = 0;
let awaitingPower = false;


function update(){
  screen.textContent = formatDisplay(current);
  expr.textContent = pendingOp && stored !== null ? `${formatNumber(stored)} ${pendingOp}` : '\u00A0';
}
function formatNumber(n){
  if (n === null || n === undefined) return '';
  if (!isFinite(n)) return String(n);
  return Number.isInteger(n) ? n.toString() : Number.parseFloat(n.toPrecision(12)).toString();
}
function formatDisplay(s){
  if (String(s).length > 14) {
    try { return Number(s).toExponential(6); } catch(e){ return s; }
  }
  return s;
}
function resetAll(){
  current = "0"; stored = null; pendingOp = null; shouldReset = false; awaitingPower=false;
  update();
}

/* Input digit */
function inputDigit(d){
  if (shouldReset) { current = (d === '.') ? '0.' : d; shouldReset = false; }
  else {
    if (d === '.' && current.includes('.')) return;
    current = (current === '0' && d !== '.') ? d : current + d;
  }
  update();
}


function applyOp(op){
  if (awaitingPower && op !== '=') {
    stored = Math.pow(Number(stored), Number(current));
    current = String(stored);
    awaitingPower = false;
    pendingOp = null;
    shouldReset = true;
    update();
    return;
  }

  if (stored === null) stored = Number(current);
  else if (pendingOp) stored = evaluate(pendingOp, stored, Number(current));
  if (op === '=') {
    if (pendingOp !== null) {
      current = String(stored);
      pendingOp = null;
      shouldReset = true;
      update();
    }
  } else {
    pendingOp = op;
    shouldReset = true;
    update();
  }
}

function evaluate(op, a, b){
  switch(op){
    case '+': return a + b;
    case 'âˆ’': return a - b;
    case 'Ã—': return a * b;
    case 'Ã·': return b === 0 ? NaN : a / b;
    default: return b;
  }
}


function applyFunc(name){
  let x = Number(current);
  let res;
  switch(name){
    case 'sin': res = Math.sin(x * (Math.PI/180)); break;
    case 'cos': res = Math.cos(x * (Math.PI/180)); break;
    case 'tan': res = Math.tan(x * (Math.PI/180)); break;
    case 'ln': res = x>0? Math.log(x) : NaN; break;
    case 'log10': res = x>0? Math.log10(x) : NaN; break;
    case 'sqrt': res = Math.sqrt(x); break;
    case 'pow2': res = Math.pow(x,2); break;
    case 'pow3': res = Math.pow(x,3); break;
    case 'pi': res = Math.PI; break;
    case 'e': res = Math.E; break;
    case 'fact': res = factorial(x); break;
    case 'pow': stored = Number(x); awaitingPower = true; pendingOp = '^'; shouldReset = true; update(); return;
    case 'inv': res = x === 0 ? NaN : 1/x; break;
    default: return;
  }
  current = String(res);
  shouldReset = true;
  update();
}
function factorial(n){
  n = Math.floor(n);
  if (n < 0) return NaN;
  if (n === 0 || n === 1) return 1;
  let f = 1;
  for (let i=2;i<=n;i++) f *= i;
  return f;
}


function percent(){ current = String(Number(current)/100); update(); }
function plusMinus(){ current = String(Number(current) * -1); update(); }


function mPlus(){ memory += Number(current); flash(); }
function mMinus(){ memory -= Number(current); flash(); }
function mRecall(){ current = String(memory); shouldReset = true; update(); }
function mClear(){ memory = 0; flash(); }
function flash(){ const d=document.getElementById('deviceRoot'); d.animate([{transform:'scale(1.01)'},{transform:'scale(1)'}],{duration:220}); }

keypad.addEventListener('click', (ev) => {
  const b = ev.target.closest('button');
  if (!b) return;

  feedback('click');
  
  const digit = b.dataset.digit;
  if (digit !== undefined) { inputDigit(digit); return; }

  const action = b.dataset.action;
  if (action) {
    switch(action){
      case 'clear': resetAll(); break;
      case 'plusminus': plusMinus(); break;
      case 'percent': percent(); break;
      case 'op':
        const op = b.dataset.op;
        clearOpHighlight();
        b.classList.add('active-op');
        applyOp(op);
        break;
      case 'equals':
        applyOp('=');
        clearOpHighlight();
        break;
      case 'func':
        applyFunc(b.dataset.func);
        break;
    }
    return;
  }

  if (b.dataset.sci){
    applyFunc(b.dataset.sci);
    return;
  }
});

function clearOpHighlight(){
  document.querySelectorAll('[data-action="op"]').forEach(x => x.classList.remove('active-op'));
}


document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    feedback('soft');
    applyOp('=');
    clearOpHighlight();
  }
});


document.getElementById('mPlus').addEventListener('click', ()=>{ feedback('soft'); mPlus(); });
document.getElementById('mMinus').addEventListener('click', ()=>{ feedback('soft'); mMinus(); });
document.getElementById('mrc').addEventListener('click', ()=>{ feedback('soft'); mRecall(); });
document.getElementById('mc').addEventListener('click', ()=>{ feedback('soft'); mClear(); });

function adaptScientific(){
  if (window.innerWidth >= 540){
    sciPanel.style.display = 'grid';
    sciPanel.setAttribute('aria-hidden','false');
  } else {
    sciPanel.style.display = 'none';
    sciPanel.setAttribute('aria-hidden','true');
  }
}
window.addEventListener('resize', adaptScientific);
adaptScientific();


resetAll();


const THEME_KEY = 'kg_scientific_theme';
const themeBtn = document.getElementById('themeCycle');
const root = document.documentElement;
function setTheme(name){
  root.classList.remove('light','night');
  if (name === 'light') root.classList.add('light');
  if (name === 'night') root.classList.add('night');
  localStorage.setItem(THEME_KEY, name);
  themeBtn.textContent = name === 'light' ? 'ðŸŒž' : (name === 'night' ? 'ðŸŒš' : 'ðŸŒ™');
}
themeBtn.addEventListener('click', ()=>{
  const cur = localStorage.getItem(THEME_KEY) || 'dark';
  const next = cur === 'dark' ? 'light' : (cur === 'light' ? 'night' : 'dark');
  setTheme(next);
});
(function(){ const saved = localStorage.getItem(THEME_KEY) || 'dark'; setTheme(saved); })();

function ensureAudio(){
  if (window.audioContext) return;
  try{
    window.audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }catch(e){
    window.audioContext = null;
  }
}
function playTone(freq, length=0.06, type='sine'){
  ensureAudio();
  if (!window.audioContext) return;
  const ac = window.audioContext;
  const o = ac.createOscillator();
  const g = ac.createGain();
  o.type = type;
  o.frequency.value = freq;
  g.gain.value = 0.0006;
  o.connect(g); g.connect(ac.destination);
  o.start();
  const now = ac.currentTime;
  g.gain.setValueAtTime(g.gain.value, now);
  g.gain.exponentialRampToValueAtTime(0.000001, now + length);
  o.stop(now + length + 0.01);
}

function feedback(kind='click'){

  try{ if (window.audioContext && window.audioContext.state === 'suspended') { window.audioContext.resume(); } } catch(e){}
  if (kind === 'soft') playTone(760, 0.06, 'sine');
  else playTone(1200, 0.05, 'square');
  if (navigator.vibrate) navigator.vibrate(10);
}

document.body.addEventListener('touchstart', ()=>{}, {passive:true});
</script>
</body>
</html>
